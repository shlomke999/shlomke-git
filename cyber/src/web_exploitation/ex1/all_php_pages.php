########## initial html home page for apache2 (locate it in /var/www/html)#########
<!DOCTYPE html>
<html>
<head>
    <title>dumbDB</title>
</head>
<body>
    <h1>login</h1>
    <form action="submit.php" method="post">
        <label for="username">Username:</label>
        <input type="text" id="inputusername" name="username" required><br><br>

        <label for="password">Password:</label>
        <input type="password" id="inputpassword" name="password" required><br><br>

        <input type="submit" value="Login">
    </form>
</body>
</html>


############# submit.php (locate it in /var/www/html)#############
<?php
 
//Include the connection script (will execute it automatically.)
Include ("dbconnection.php");
 
session_start();

if ($_SERVER["REQUEST_METHOD"] === "POST")  //(maybe we have an extra =?)
{

// Get input data from the form (in the html page)
$inputusername = $_POST["username"];
$inputpassword = $_POST["password"];

$inputpassword = md5($inputpassword);

echo "</br>"."user name: $inputusername"."</br>"." password after hash: $inputpassword";

$stmt = $connect->prepare("SELECT phone_num FROM mysqltable WHERE user=? AND password=?");  //mysqltable - the sql table name
$stmt->bind_param("ss", $inputusername, $inputpassword);
$stmt->execute();
$result = $stmt->get_result();

if ($result->num_rows) //if we have a match for the query (there is a user with those details).
{ 
	$_SESSION["timeout"] = time() + (30); // create a variable named timeout for the session that will last for 30 seconds
	while($row = $result->fetch_assoc()) 
   	{
        $_SESSION["number"]=$row["phone_num"];
	}
	// go to result.php page that displays the number until session ends: 
	header("Location: result.php"); // Redirect after successful login	
}	

else
    {echo "No record found";}

}
 
$conn->close();
?>


###########  dbconnection.php ##########
<?php

$server="localhost";
$username="shlomke";
$password="123";
$database = "mysqltable";

/* Create database  connection with correct username and password*/

$connect=new mysqli($server,$username,$password,$database);

/* Check the connection is created properly or not */
if($connect->connect_error)
    echo "Connection error:" .$connect->connect_error;
else
    echo "Connection is created successfully";     ?>



###########  result.php #############


<?php
    session_start();
    
    if (time() < $_SESSION['timeout'])
	{  
	    echo "your phone number is: " . $_SESSION["number"];
	}

else
{
 session_unset();
 session_destroy(); 
}    
?>
 
 

